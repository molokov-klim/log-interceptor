# SPDX-FileCopyrightText: 2023 Molokov Klim
#
# SPDX-License-Identifier: MIT

---
name: Publish Python Package

on: # yamllint disable-line rule:truthy
  workflow_dispatch: { }

permissions:
  contents: read

jobs:
  # Purpose: Builds and publishes the package to PyPI for distribution
  # What it does: Builds wheel and source distributions, uploads to PyPI
  #               using twine with API token authentication
  # Problems it solves: Automates package release process, ensures
  #                     consistent builds, makes package available for pip
  #                     installation by end users
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install build

      - name: Build package
        run: python -m build

      - name: Publish package
        run: |
          python -m pip install --upgrade twine
          ls dist || exit 1
          python -m twine upload --repository pypi dist/*
        env:
          TWINE_USERNAME: __token__
          TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}

# Local run:
# - Install build tools:
#   pip install build twine
# - Build package:
#   python -m build
# - Check distribution:
#   twine check dist/*
# - Test upload to TestPyPI (requires account):
#   twine upload --repository testpypi dist/*
# - Upload to PyPI (requires API token):
#   twine upload dist/*
